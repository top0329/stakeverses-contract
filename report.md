# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.

# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [Medium Issues](#medium-issues)
  - [M-1: Using `ERC721::_mint()` can be dangerous](#m-1-using-erc721mint-can-be-dangerous)
- [Low Issues](#low-issues)
  - [L-1: Unsafe ERC20 Operations should not be used](#l-1-unsafe-erc20-operations-should-not-be-used)
  - [L-2: Solidity pragma should be specific, not wide](#l-2-solidity-pragma-should-be-specific-not-wide)
  - [L-3: PUSH0 is not supported by all chains](#l-3-push0-is-not-supported-by-all-chains)
- [NC Issues](#nc-issues)
  - [NC-1: Missing checks for `address(0)` when assigning values to address state variables](#nc-1-missing-checks-for-address0-when-assigning-values-to-address-state-variables)
  - [NC-2: `public` functions not used internally could be marked `external`](#nc-2-public-functions-not-used-internally-could-be-marked-external)
  - [NC-3: Define and use `constant` variables instead of using literals](#nc-3-define-and-use-constant-variables-instead-of-using-literals)
  - [NC-4: Event is missing `indexed` fields](#nc-4-event-is-missing-indexed-fields)
  - [NC-5: Inconsistency in declaring uint256/uint (or) int256/int variables within a contract](#nc-5-inconsistency-in-declaring-uint256uint-or-int256int-variables-within-a-contract)

# Summary

## Files Summary

| Key         | Value |
| ----------- | ----- |
| .sol Files  | 10    |
| Total nSLOC | 660   |

## Files Details

| Filepath                                         | nSLOC   |
| ------------------------------------------------ | ------- |
| contracts/ProductStaking.sol                     | 245     |
| contracts/ProductStakingInstance.sol             | 113     |
| contracts/StkToken.sol                           | 65      |
| contracts/TestERC1155.sol                        | 17      |
| contracts/TestERC20.sol                          | 44      |
| contracts/TestProduct.sol                        | 82      |
| contracts/interfaces/IERC20.sol                  | 17      |
| contracts/interfaces/IProductStakingInstance.sol | 26      |
| contracts/interfaces/IProductToken.sol           | 22      |
| contracts/interfaces/IStakingInfo.sol            | 29      |
| **Total**                                        | **660** |

## Issue Summary

| Category | No. of Issues |
| -------- | ------------- |
| Critical | 0             |
| High     | 0             |
| Medium   | 1             |
| Low      | 3             |
| NC       | 5             |

# Medium Issues

## M-1: Using `ERC721::_mint()` can be dangerous

Using `ERC721::_mint()` can mint ERC721 tokens to addresses which don't support ERC721 tokens. Use `_safeMint()` instead of `_mint()` for ERC721.

- Found in contracts/TestERC1155.sol [Line: 13](contracts/TestERC1155.sol#L13)

  ```solidity
          _mint(msg.sender, GOLD, 10**18, "");
  ```

- Found in contracts/TestERC1155.sol [Line: 14](contracts/TestERC1155.sol#L14)

  ```solidity
          _mint(msg.sender, SILVER, 10**27, "");
  ```

- Found in contracts/TestERC1155.sol [Line: 15](contracts/TestERC1155.sol#L15)

  ```solidity
          _mint(msg.sender, THORS_HAMMER, 1, "");
  ```

- Found in contracts/TestERC1155.sol [Line: 16](contracts/TestERC1155.sol#L16)

  ```solidity
          _mint(msg.sender, SWORD, 10**9, "");
  ```

- Found in contracts/TestERC1155.sol [Line: 20](contracts/TestERC1155.sol#L20)

  ```solidity
          _mint(account, id, amount, data);
  ```

- Found in contracts/TestProduct.sol [Line: 64](contracts/TestProduct.sol#L64)

  ```solidity
          _mint(to, id, amount, data); // Mint Product NFT
  ```

# Low Issues

## L-1: Unsafe ERC20 Operations should not be used

ERC20 functions may not behave as expected. For example: return values are not always meaningful. It is recommended to use OpenZeppelin's SafeERC20 library.

- Found in contracts/ProductStaking.sol [Line: 134](contracts/ProductStaking.sol#L134)

  ```solidity
          IERC20(rewardTokens[i].tokenAddress).transfer(receiver, claimableRewards[i] * (10 ** IERC20(rewardTokens[i].tokenAddress).decimals()));
  ```

- Found in contracts/ProductStaking.sol [Line: 193](contracts/ProductStaking.sol#L193)

  ```solidity
          IERC20(rewardTokens[i].tokenAddress).transferFrom(msg.sender, address(this), rewardTokens[i].ratio * rewardBaseAmountValue);
  ```

- Found in contracts/ProductStakingInstance.sol [Line: 54](contracts/ProductStakingInstance.sol#L54)

  ```solidity
          IERC20(rewardInfos[i].tokenAddress).transferFrom(msg.sender, address(this), rewardBaseAmount * rewardInfos[i].ratio * (10 ** IERC20(rewardInfos[i].tokenAddress).decimals()));
  ```

- Found in contracts/ProductStakingInstance.sol [Line: 91](contracts/ProductStakingInstance.sol#L91)

  ```solidity
  				IERC20(rewardInfos[i].tokenAddress).transfer(address(_productStaking), rewardBaseAmount * rewardInfos[i].ratio * (10 ** IERC20(rewardInfos[i].tokenAddress).decimals()));
  ```

## L-2: Solidity pragma should be specific, not wide

Consider using a specific version of Solidity in your contracts instead of a wide version. For example, instead of `pragma solidity ^0.8.0;`, use `pragma solidity 0.8.0;`

- Found in contracts/ProductStaking.sol [Line: 2](contracts/ProductStaking.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

- Found in contracts/ProductStakingInstance.sol [Line: 2](contracts/ProductStakingInstance.sol#L2)

  ```solidity
  pragma solidity ^0.8.0;
  ```

- Found in contracts/StkToken.sol [Line: 2](contracts/StkToken.sol#L2)

  ```solidity
  pragma solidity ^0.8.24;
  ```

- Found in contracts/TestERC1155.sol [Line: 2](contracts/TestERC1155.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

- Found in contracts/TestERC20.sol [Line: 2](contracts/TestERC20.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

- Found in contracts/TestProduct.sol [Line: 2](contracts/TestProduct.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

- Found in contracts/interfaces/IERC20.sol [Line: 2](contracts/interfaces/IERC20.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

- Found in contracts/interfaces/IProductStakingInstance.sol [Line: 2](contracts/interfaces/IProductStakingInstance.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

- Found in contracts/interfaces/IProductToken.sol [Line: 2](contracts/interfaces/IProductToken.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

- Found in contracts/interfaces/IStakingInfo.sol [Line: 2](contracts/interfaces/IStakingInfo.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

## L-3: PUSH0 is not supported by all chains

Solc compiler version 0.8.20 switches the default target EVM version to Shanghai, which means that the generated bytecode will include PUSH0 opcodes. Be sure to select the appropriate EVM version in case you intend to deploy on a chain other than mainnet like L2 chains that may not support PUSH0, otherwise deployment of your contracts will fail.

- Found in contracts/ProductStaking.sol [Line: 2](contracts/ProductStaking.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

- Found in contracts/ProductStakingInstance.sol [Line: 2](contracts/ProductStakingInstance.sol#L2)

  ```solidity
  pragma solidity ^0.8.0;
  ```

- Found in contracts/StkToken.sol [Line: 2](contracts/StkToken.sol#L2)

  ```solidity
  pragma solidity ^0.8.24;
  ```

- Found in contracts/TestERC1155.sol [Line: 2](contracts/TestERC1155.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

- Found in contracts/TestERC20.sol [Line: 2](contracts/TestERC20.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

- Found in contracts/TestProduct.sol [Line: 2](contracts/TestProduct.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

- Found in contracts/interfaces/IERC20.sol [Line: 2](contracts/interfaces/IERC20.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

- Found in contracts/interfaces/IProductStakingInstance.sol [Line: 2](contracts/interfaces/IProductStakingInstance.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

- Found in contracts/interfaces/IProductToken.sol [Line: 2](contracts/interfaces/IProductToken.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

- Found in contracts/interfaces/IStakingInfo.sol [Line: 2](contracts/interfaces/IStakingInfo.sol#L2)

  ```solidity
  pragma solidity ^0.8.20;
  ```

# NC Issues

## NC-1: Missing checks for `address(0)` when assigning values to address state variables

Check for `address(0)` when assigning values to address state variables.

- Found in contracts/ProductStaking.sol [Line: 65](contracts/ProductStaking.sol#L65)

  ```solidity
      _stkToken = new StkToken(stkName, stkSymbol);
  ```

- Found in contracts/ProductStaking.sol [Line: 66](contracts/ProductStaking.sol#L66)

  ```solidity
      _productToken = IProduct(productTokenAddress);
  ```

- Found in contracts/ProductStaking.sol [Line: 67](contracts/ProductStaking.sol#L67)

  ```solidity
      creator = _creator;
  ```

- Found in contracts/ProductStakingInstance.sol [Line: 31](contracts/ProductStakingInstance.sol#L31)

  ```solidity
  		_productTokenAddress = productTokenAddress;
  ```

- Found in contracts/StkToken.sol [Line: 37](contracts/StkToken.sol#L37)

  ```solidity
        balanceOf[msg.sender] -= amount;
  ```

- Found in contracts/StkToken.sol [Line: 38](contracts/StkToken.sol#L38)

  ```solidity
        balanceOf[recipient] += amount;
  ```

- Found in contracts/StkToken.sol [Line: 44](contracts/StkToken.sol#L44)

  ```solidity
        allowance[msg.sender][spender] = amount;
  ```

- Found in contracts/StkToken.sol [Line: 53](contracts/StkToken.sol#L53)

  ```solidity
        allowance[sender][msg.sender] -= amount;
  ```

- Found in contracts/StkToken.sol [Line: 54](contracts/StkToken.sol#L54)

  ```solidity
        balanceOf[sender] -= amount;
  ```

- Found in contracts/StkToken.sol [Line: 55](contracts/StkToken.sol#L55)

  ```solidity
        balanceOf[recipient] += amount;
  ```

- Found in contracts/StkToken.sol [Line: 61](contracts/StkToken.sol#L61)

  ```solidity
        balanceOf[to] += amount;
  ```

- Found in contracts/StkToken.sol [Line: 67](contracts/StkToken.sol#L67)

  ```solidity
        balanceOf[from] -= amount;
  ```

- Found in contracts/TestERC20.sol [Line: 25](contracts/TestERC20.sol#L25)

  ```solidity
          balanceOf[msg.sender] += amount;
  ```

- Found in contracts/TestERC20.sol [Line: 32](contracts/TestERC20.sol#L32)

  ```solidity
          balanceOf[msg.sender] -= _value;
  ```

- Found in contracts/TestERC20.sol [Line: 33](contracts/TestERC20.sol#L33)

  ```solidity
          balanceOf[_to] += _value;
  ```

- Found in contracts/TestERC20.sol [Line: 39](contracts/TestERC20.sol#L39)

  ```solidity
          allowance[msg.sender][_spender] = _value;
  ```

- Found in contracts/TestERC20.sol [Line: 49](contracts/TestERC20.sol#L49)

  ```solidity
          balanceOf[_from] -= _value;
  ```

- Found in contracts/TestERC20.sol [Line: 50](contracts/TestERC20.sol#L50)

  ```solidity
          balanceOf[_to] += _value;
  ```

- Found in contracts/TestERC20.sol [Line: 51](contracts/TestERC20.sol#L51)

  ```solidity
          allowance[_from][msg.sender] -= _value;
  ```

## NC-2: `public` functions not used internally could be marked `external`

Instead of marking a function as `public`, consider marking it as `external` if it is not used internally.

- Found in contracts/ProductStaking.sol [Line: 281](contracts/ProductStaking.sol#L281)

  ```solidity
    function onERC1155Received(
  ```

- Found in contracts/TestERC1155.sol [Line: 19](contracts/TestERC1155.sol#L19)

  ```solidity
      function mint(address account, uint256 id, uint256 amount, bytes memory data) public {
  ```

- Found in contracts/TestProduct.sol [Line: 101](contracts/TestProduct.sol#L101)

  ```solidity
      function uri(uint256 tokenId) public view virtual override returns (string memory) {
  ```

## NC-3: Define and use `constant` variables instead of using literals

If the same constant literal value is used multiple times, create a constant state variable and reference it throughout the contract.

- Found in contracts/ProductStakingInstance.sol [Line: 47](contracts/ProductStakingInstance.sol#L47)

  ```solidity
  		require(productInfos.length <= 4, "Product token count exceeded");
  ```

- Found in contracts/ProductStakingInstance.sol [Line: 48](contracts/ProductStakingInstance.sol#L48)

  ```solidity
  		require(rewardInfos.length <= 4, "Reward token count exceeded");
  ```

- Found in contracts/ProductStakingInstance.sol [Line: 54](contracts/ProductStakingInstance.sol#L54)

  ```solidity
          IERC20(rewardInfos[i].tokenAddress).transferFrom(msg.sender, address(this), rewardBaseAmount * rewardInfos[i].ratio * (10 ** IERC20(rewardInfos[i].tokenAddress).decimals()));
  ```

- Found in contracts/ProductStakingInstance.sol [Line: 91](contracts/ProductStakingInstance.sol#L91)

  ```solidity
  				IERC20(rewardInfos[i].tokenAddress).transfer(address(_productStaking), rewardBaseAmount * rewardInfos[i].ratio * (10 ** IERC20(rewardInfos[i].tokenAddress).decimals()));
  ```

- Found in contracts/TestERC1155.sol [Line: 13](contracts/TestERC1155.sol#L13)

  ```solidity
          _mint(msg.sender, GOLD, 10**18, "");
  ```

- Found in contracts/TestERC1155.sol [Line: 14](contracts/TestERC1155.sol#L14)

  ```solidity
          _mint(msg.sender, SILVER, 10**27, "");
  ```

- Found in contracts/TestERC1155.sol [Line: 16](contracts/TestERC1155.sol#L16)

  ```solidity
          _mint(msg.sender, SWORD, 10**9, "");
  ```

## NC-4: Event is missing `indexed` fields

Index event fields make the field more quickly accessible to off-chain tools that parse events. However, note that each index field costs extra gas during emission, so it's not necessarily best to index the maximum allowed per event (three fields). Each event should use three indexed fields if there are three or more fields, and gas usage is not particularly of concern for the events in question. If there are fewer than three fields, all of the fields should be indexed.

- Found in contracts/ProductStaking.sol [Line: 38](contracts/ProductStaking.sol#L38)

  ```solidity
    event Staking(address indexed staker, uint256 amount, uint256 stakingDate, uint256 indexed instanceId);
  ```

- Found in contracts/ProductStaking.sol [Line: 39](contracts/ProductStaking.sol#L39)

  ```solidity
    event MintStkToken(address indexed staker, address indexed stkTokenAddress, uint256 amount, uint256 stakingDate);
  ```

- Found in contracts/StkToken.sol [Line: 16](contracts/StkToken.sol#L16)

  ```solidity
      event Transfer(address indexed from, address indexed to, uint256 value);
  ```

- Found in contracts/StkToken.sol [Line: 17](contracts/StkToken.sol#L17)

  ```solidity
      event Approval(
  ```

- Found in contracts/TestERC20.sol [Line: 13](contracts/TestERC20.sol#L13)

  ```solidity
      event Transfer(address indexed from, address indexed to, uint256 value);
  ```

- Found in contracts/TestERC20.sol [Line: 14](contracts/TestERC20.sol#L14)

  ```solidity
      event Approval(address indexed owner, address indexed spender, uint256 value);
  ```

- Found in contracts/TestProduct.sol [Line: 20](contracts/TestProduct.sol#L20)

  ```solidity
      event ProductCreated(uint256 indexed tokenId, address creator, uint256 indexed blueprintId);
  ```

- Found in contracts/TestProduct.sol [Line: 21](contracts/TestProduct.sol#L21)

  ```solidity
      event ProductMinted(
  ```

- Found in contracts/TestProduct.sol [Line: 24](contracts/TestProduct.sol#L24)

  ```solidity
      event ProductBurned(address indexed to, uint256 indexed id, uint256 amount, uint256 mintedAmountOfId, uint256 totalMintedAmount);
  ```

- Found in contracts/interfaces/IProductToken.sol [Line: 15](contracts/interfaces/IProductToken.sol#L15)

  ```solidity
      event ProductCreated(uint256 indexed tokenId, address creator, uint256 indexed blueprintId);
  ```

- Found in contracts/interfaces/IProductToken.sol [Line: 16](contracts/interfaces/IProductToken.sol#L16)

  ```solidity
      event ProductMinted(address indexed to, uint256 indexed id, uint256 amount, uint256 mintedAmountOfId, uint256 totalMintedAmount);
  ```

- Found in contracts/interfaces/IProductToken.sol [Line: 17](contracts/interfaces/IProductToken.sol#L17)

  ```solidity
      event ProductBurned(address indexed to, uint256 indexed id, uint256 amount, uint256 mintedAmountOfId, uint256 totalMintedAmount);
  ```

## NC-5: Inconsistency in declaring uint256/uint (or) int256/int variables within a contract

Consider keeping the naming convention consistent in a given contract

- Found in contracts/ProductStaking.sol [Line: 13](contracts/ProductStaking.sol#L13)

  ```solidity
  contract ProductStaking is IStakingInfo {
  ```

- Found in contracts/ProductStakingInstance.sol [Line: 9](contracts/ProductStakingInstance.sol#L9)

  ```solidity
  contract ProductStakingInstance is IStakingInfo{
  ```
